language: python
matrix:
  include:
  - os: linux
    sudo: false
    dist: trusty
    python: '2.7'
  - os: linux
    sudo: false
    dist: trusty
    python: '3.4'
  - os: linux
    sudo: false
    dist: trusty
    python: '3.5'
  - os: osx
    language: generic
    env: TRAVIS_PYTHON_VERSION=3.5
before_install:
- wget https://raw.githubusercontent.com/Horta/travis-miniconda/master/install.sh
  -O install.sh
- chmod +x install.sh
- travis_retry bash -x ./install.sh
install:
- export PATH="$HOME/miniconda/bin:$PATH"
- source activate travisci
before_script:
- export PATH="$HOME/miniconda/bin:$PATH"
- source activate travisci
- python setup.py test
script:
- export PATH="$HOME/miniconda/bin:$PATH"
- source activate travisci
- python setup.py sdist
- pip install dist/`ls dist | grep -i -E '\.(gz)$' | head -1`
- pushd /
- python -c "import numpy_sugar; numpy_sugar.test()"
- popd
branches:
  only:
  - master
notifications:
  email: false
deploy:
  provider: pypi
  user: dhorta
  password:
    secure: r7+bdC6eFyMdZ03w5QdVZkb9NYOGm/aCzg+DevZLgZXWADoOh7aGD+DxnKZdxrvVKdJnEr+96xoxvFfehT0EvALo9AJEI8Y78BIk9fV8K4NqFI/2DJeMAQ+2U9VWDyvscRXfpgwpqt7/FcllXebofEsnJNKrA9WYlC+i1G6lJzYBD5+COrNuG9YPU/E5H3q+msePkbwspaWt8QD1+ijNbdB4xIKRKg2M/fDVUDoK9dDzPgfwTf+ZCMw3sjeTY5/0PgwuHQgZsRr/Ub7SPB2ryjq0RkNAJxrvyhzRP0vrFztrzjjs3OVewgzCgr3bKenk7zqcQRl9XIzGWUHaHDUQpVtCmh1V0xnG+plJyGp1zsJXQTHBK16J5SAUbtmwqR52CgSskiTkKaTvG1W6H96n67smoVAzRWoPBe4edh3GyQPnuLOlkUt7Rvmt+DukKDhbKSv5F+E2suZyzo6xvaVGIe/okex6RQJtrNdNe32xbwWBGrYcowtZXp1rNxS0Ayg1M/dIBJC6YCjVMQ7SOKauDO2Y6zLQzbZMhKyixbOg0zyj6TDcu4dCV2oOuxOd0M/M5pG+Fod0D9CfUuc0R23ABtYqQt6O68J2WnMUwM5GULv+VCqX69oX0da2IL1v2vIMyWcQaC1GZtK1RlOiCZZ5w8jKXSd25RxTyjsmqzshhuo=
  on:
    distributions: sdist bdist_wheel
    repo: Horta/numpy-sugar
